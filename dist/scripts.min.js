let pokemonRepository = (function () {
    let pokemonList = []; let apiUrl = 'https://pokeapi.co/api/v2/pokemon/?limit=150'; let searchInput = document.querySelector("#searchIn"); function add(pokemon) { pokemonList.push(pokemon) }
    function getAll() { return pokemonList }
    const pokeUl = document.querySelector('.list-group'); const baseStatsButton = document.querySelector('#base-stats-button'); let currentPokemon; function addListItem(pokemon) { let listItem = document.createElement('li'); let button = document.createElement('button'); button.innerText = pokemon.name; button.classList.add('btn'); button.classList.add('btn-primary'); listItem.classList.add('group-list-item'); button.setAttribute("data-target", "#my-modal"); button.setAttribute("data-toggle", "modal"); listItem.appendChild(button); pokeUl.appendChild(listItem); button.addEventListener('click', function () { showDetails(pokemon); currentPokemon = pokemon }) }
    baseStatsButton.addEventListener('click', showStatModal); function loadList() { return fetch(apiUrl).then(function (response) { return response.json() }).then(function (json) { json.results.forEach(function (item) { let pokemon = { name: item.name, detailsUrl: item.url }; add(pokemon) }) }).catch(function (e) { console.error(e) }) }
    function loadDetails(item) {
        let url = item.detailsUrl; return fetch(url).then(function (response) { return response.json() }).then(function (details) {
            item.imageUrl = details.sprites.front_default; item.imageUrlBack = details.sprites.back_default; item.height = details.height / 10; item.weight = details.weight / 10; item.types = []; for (var i = 0; i < details.types.length; i++) { item.types.push(details.types[i].type.name) }
            item.types = item.types.join(',  '); item.abilities = []; for (var i = 0; i < details.abilities.length; i++) { item.abilities.push(details.abilities[i].ability.name) }
            item.abilities = item.abilities.join(',  ')
        }).catch(function (e) { console.error(e) })
    }
    function loadStats(item) { let url = item.detailsUrl; return fetch(url).then(function (response) { return response.json() }).then(function (details) { item.stats = details.stats.map(({ base_stat, stat: { name } }) => `${name}: ${base_stat}`).join("<br/>") }).catch(function (e) { console.error(e) }) }
    function showDetails(item) { pokemonRepository.loadDetails(item).then(function () { console.log("item:", item); showModal(item) }) }
    function showModal(item) { pokemonRepository.loadDetails(item).then(function () { let modalBody = $(".modal-body"); let modalTitle = $(".modal-title"); modalTitle.empty(); modalBody.empty(); let nameElement = $("<h1>" + item.name + "</h1>"); let imageElementFront = $('<img class="modal-img" style="width:50%">'); imageElementFront.attr("src", item.imageUrl); let imageElementBack = $('<img class="modal-img" style="width:50%">'); imageElementBack.attr("src", item.imageUrlBack); let heightElement = $("<p>" + "Height: " + item.height + "m</p>"); let weightElement = $("<p>" + "Weight: " + item.weight + "kgs</p>"); let typesElement = $("<p>" + "Types: " + item.types + "</p>"); let typesAbilities = $("<p>" + "Abilities: " + item.abilities + "</p>"); searchInput.addEventListener('input', function () { let listPokemon = document.querySelectorAll('.group-list-item'); let value = searchInput.value.toUpperCase(); listPokemon.forEach(function (pokemon) { if (pokemon.innerText.toUpperCase().indexOf(value) > -1) { pokemon.style.display = '' } else { pokemon.style.display = 'none' } }) }); modalTitle.append(nameElement); modalBody.append(imageElementFront); modalBody.append(imageElementBack); modalBody.append(heightElement); modalBody.append(weightElement); modalBody.append(typesElement); modalBody.append(typesAbilities); $('#my-modal').modal('toggle') }) }
    function loadStatDetails(item) { pokemonRepository.loadStats(item).then(function () { showStatModal(item) }) }
    function showStatModal() { if (!currentPokemon) return; const item = currentPokemon; pokemonRepository.loadStats(item).then(function () { let StatmodalBody = $(".Statmodal-body"); let StatmodalTitle = $(".Statmodal-title"); StatmodalTitle.empty(); StatmodalBody.empty(); let nameElement = $("<h1>" + item.name + "</h1>"); let statsElement = $("<p>" + item.stats + "<p>"); StatmodalTitle.append(nameElement); StatmodalBody.append(statsElement); $('#my-Statmodal').modal('show') }) }
    return { add: add, getAll: getAll, addListItem: addListItem, loadList: loadList, loadDetails: loadDetails, showDetails: showDetails, loadStats: loadStats, loadStatDetails: loadStatDetails, }
})(); pokemonRepository.loadList().then(function () { pokemonRepository.getAll().forEach(function (pokemon) { pokemonRepository.addListItem(pokemon) }) }); let link = document.getElementById("back-to-top"); var amountScrolled = 250; window.addEventListener('scroll', function (e) { if (this.window.pageYOffset > amountScrolled) { link.classList.add('show') } else { link.className = 'back-to-top' } }); link.addEventListener('click', function (e) { e.preventDefault(); var distance = 0 - window.pageYOffset; var increments = distance / (500 / 16); function animateScroll() { window.scrollBy(0, increments); if (window.pageYOffset <= document.body.offsetTop) { clearInterval(runAnimation) } }; var runAnimation = setInterval(animateScroll, 16) })